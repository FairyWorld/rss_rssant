## seaweedfs benchmark

结论：单个磁盘，增大 volume 数对性能提升非常小，增大客户端并发数对性能提升非常小。

假设每个请求耗时 1ms，这 1ms 几乎都是磁盘IO时间，而磁盘IO是串行的。
所以假如有100个请求，无论是串行还是并行，都要100ms才处理完。

提升性能唯一办法是使用多个磁盘，seaweedfs几乎优化到磁盘性能极限了。

### mac docker

```
1 volume, 1 concurrency
0 ------------------------------------------------------------
avg=2.7 p50=2.6 p80=2.8 p90=3.0 p95=3.6 p99=5.9 qps=373
avg=2.4 p50=2.3 p80=2.6 p90=2.9 p95=3.2 p99=4.6 qps=415
1 ------------------------------------------------------------
avg=2.7 p50=2.6 p80=2.9 p90=3.2 p95=3.7 p99=5.7 qps=368
avg=2.4 p50=2.4 p80=2.6 p90=2.8 p95=3.1 p99=4.5 qps=409
2 ------------------------------------------------------------
avg=2.6 p50=2.5 p80=2.8 p90=3.0 p95=3.3 p99=5.9 qps=383
avg=2.3 p50=2.2 p80=2.4 p90=2.6 p95=2.8 p99=3.2 qps=444
```

```
2 volume, 2 concurrency
0 ------------------------------------------------------------
avg=5.3 p50=3.4 p80=4.6 p90=6.0 p95=22.8 p99=40.7 qps=381
avg=4.3 p50=2.9 p80=3.7 p90=4.5 p95=6.0 p99=37.3 qps=470
1 ------------------------------------------------------------
avg=5.1 p50=3.4 p80=4.5 p90=5.7 p95=14.0 p99=38.1 qps=393
avg=4.4 p50=2.9 p80=3.7 p90=4.5 p95=6.3 p99=36.7 qps=459
2 ------------------------------------------------------------
avg=5.3 p50=3.5 p80=4.6 p90=5.7 p95=25.2 p99=41.4 qps=378
avg=4.2 p50=2.9 p80=3.8 p90=4.8 p95=6.4 p99=37.0 qps=475
```

```
2 volume, 20 concurrency
0 ------------------------------------------------------------
avg=55.2 p50=66.5 p80=86.4 p90=92.1 p95=97.3 p99=109.5 qps=363
avg=44.9 p50=26.5 p80=77.5 p90=84.6 p95=89.5 p99=96.3 qps=445
1 ------------------------------------------------------------
avg=57.4 p50=71.7 p80=87.9 p90=94.1 p95=98.4 p99=109.9 qps=349
avg=45.7 p50=27.6 p80=76.7 p90=84.3 p95=90.4 p99=101.4 qps=438
2 ------------------------------------------------------------
avg=60.3 p50=74.0 p80=90.9 p90=96.9 p95=101.9 p99=111.1 qps=332
avg=43.9 p50=23.5 p80=76.9 p90=83.8 p95=88.6 p99=96.0 qps=456
```

```
10 volume, 20 concurrency
0 ------------------------------------------------------------
avg=60.3 p50=75.4 p80=90.3 p90=95.2 p95=100.6 p99=107.3 qps=332
avg=53.9 p50=62.8 p80=86.2 p90=92.4 p95=97.6 p99=104.4 qps=371
1 ------------------------------------------------------------
avg=58.1 p50=71.2 p80=88.7 p90=95.2 p95=98.7 p99=105.7 qps=344
avg=47.2 p50=25.8 p80=80.1 p90=86.7 p95=91.0 p99=100.1 qps=424
2 ------------------------------------------------------------
avg=59.0 p50=68.7 p80=89.0 p90=95.2 p95=101.0 p99=107.9 qps=339
avg=49.3 p50=44.1 p80=81.9 p90=88.3 p95=94.9 p99=100.8 qps=406
```

### aliyun

```
num_volume=1 concurrency=1
0 ------------------------------------------------------------
avg=1.2 p50=1.2 p80=1.2 p90=1.3 p95=1.5 p99=1.9 qps=829
avg=0.8 p50=0.8 p80=0.8 p90=0.9 p95=1.2 p99=1.6 qps=1231
1 ------------------------------------------------------------
avg=1.2 p50=1.2 p80=1.2 p90=1.3 p95=1.4 p99=1.7 qps=837
avg=0.8 p50=0.8 p80=0.8 p90=0.8 p95=0.9 p99=1.2 qps=1291
2 ------------------------------------------------------------
avg=1.3 p50=1.2 p80=1.3 p90=1.5 p95=1.6 p99=2.6 qps=784
avg=0.8 p50=0.8 p80=0.8 p90=0.8 p95=1.0 p99=1.7 qps=1245
```

```
num_volume=2 concurrency=2
0 ------------------------------------------------------------
avg=2.2 p50=2.2 p80=2.3 p90=2.4 p95=2.7 p99=3.4 qps=912
avg=1.5 p50=1.4 p80=1.5 p90=1.5 p95=1.6 p99=3.1 qps=1335
1 ------------------------------------------------------------
avg=2.2 p50=2.2 p80=2.3 p90=2.4 p95=3.0 p99=4.2 qps=901
avg=1.5 p50=1.4 p80=1.5 p90=1.5 p95=1.6 p99=1.8 qps=1365
2 ------------------------------------------------------------
avg=2.2 p50=2.2 p80=2.3 p90=2.4 p95=3.0 p99=3.7 qps=912
avg=1.6 p50=1.4 p80=1.6 p90=1.8 p95=2.9 p99=4.9 qps=1222
```

```
num_volume=2 concurrency=20
0 ------------------------------------------------------------
avg=20.0 p50=20.0 p80=22.1 p90=23.4 p95=25.2 p99=30.1 qps=1002
avg=14.5 p50=14.1 p80=14.4 p90=15.5 p95=19.6 p99=26.4 qps=1376
1 ------------------------------------------------------------
avg=20.2 p50=20.1 p80=22.3 p90=23.8 p95=25.1 p99=28.2 qps=991
avg=13.8 p50=13.6 p80=13.8 p90=14.4 p95=15.2 p99=22.1 qps=1446
2 ------------------------------------------------------------
avg=20.4 p50=20.1 p80=22.2 p90=24.2 p95=26.1 p99=31.0 qps=980
avg=13.6 p50=13.6 p80=13.8 p90=14.1 p95=14.4 p99=14.6 qps=1475
```

```
num_volume=10 concurrency=20
0 ------------------------------------------------------------
avg=19.7 p50=19.7 p80=21.3 p90=23.1 p95=25.4 p99=30.6 qps=1013
avg=13.6 p50=13.6 p80=14.0 p90=14.4 p95=14.7 p99=15.1 qps=1467
1 ------------------------------------------------------------
avg=19.9 p50=20.0 p80=21.7 p90=23.0 p95=24.9 p99=29.5 qps=1003
avg=14.8 p50=13.8 p80=15.8 p90=18.4 p95=22.5 p99=28.1 qps=1351
2 ------------------------------------------------------------
avg=19.6 p50=19.7 p80=21.2 p90=22.7 p95=24.3 p99=27.0 qps=1020
avg=14.0 p50=13.6 p80=14.1 p90=14.8 p95=18.1 p99=24.5 qps=1427
```

## postgres benchmark

结论：吞吐量略高于seaweedfs，延迟略低于seaweedfs。

批量写性能会显著优于seaweedfs，因为一个事务里的磁盘写操作可以合并，减少fsync调用。

### mac docker

```
concurrency=1
0 ------------------------------------------------------------
avg=3.6 p50=3.5 p80=3.9 p90=4.2 p95=4.6 p99=6.4 qps=275
avg=3.2 p50=3.1 p80=3.5 p90=3.8 p95=4.2 p99=5.0 qps=310
1 ------------------------------------------------------------
avg=3.9 p50=3.8 p80=4.2 p90=4.6 p95=4.9 p99=6.4 qps=254
avg=3.1 p50=2.9 p80=3.3 p90=3.7 p95=4.0 p99=7.9 qps=322
2 ------------------------------------------------------------
avg=4.2 p50=3.9 p80=4.5 p90=4.9 p95=5.4 p99=8.5 qps=240
avg=3.2 p50=3.1 p80=3.5 p90=3.8 p95=4.1 p99=4.8 qps=310
```

```
concurrency=2
0 ------------------------------------------------------------
avg=4.7 p50=4.5 p80=5.2 p90=5.8 p95=6.3 p99=8.2 qps=426
avg=3.6 p50=3.5 p80=4.0 p90=4.4 p95=4.7 p99=6.5 qps=556
1 ------------------------------------------------------------
avg=4.5 p50=4.4 p80=4.9 p90=5.4 p95=5.8 p99=7.1 qps=443
avg=3.7 p50=3.5 p80=4.0 p90=4.4 p95=4.7 p99=7.3 qps=547
2 ------------------------------------------------------------
avg=4.7 p50=4.5 p80=5.1 p90=5.6 p95=6.2 p99=7.7 qps=426
avg=3.8 p50=3.6 p80=4.2 p90=4.7 p95=5.3 p99=6.3 qps=529
```

```
concurrency=5
0 ------------------------------------------------------------
avg=10.5 p50=7.3 p80=10.1 p90=19.2 p95=38.2 p99=50.1 qps=474
avg=5.9 p50=5.4 p80=6.5 p90=7.4 p95=9.7 p99=15.8 qps=853
1 ------------------------------------------------------------
avg=10.7 p50=7.4 p80=10.1 p90=28.8 p95=38.5 p99=45.0 qps=466
avg=6.2 p50=5.6 p80=6.8 p90=7.9 p95=9.2 p99=20.7 qps=813
2 ------------------------------------------------------------
avg=10.5 p50=7.8 p80=10.7 p90=21.1 p95=33.8 p99=38.5 qps=475
avg=6.5 p50=6.3 p80=7.6 p90=8.5 p95=9.3 p99=12.3 qps=768
```

```
concurrency=10
0 ------------------------------------------------------------
avg=21.7 p50=15.7 p80=37.6 p90=47.1 p95=52.2 p99=60.7 qps=461
avg=14.7 p50=12.7 p80=18.2 p90=26.0 p95=35.7 p99=41.6 qps=680
1 ------------------------------------------------------------
avg=22.4 p50=16.0 p80=40.3 p90=52.0 p95=56.1 p99=62.7 qps=447
avg=13.3 p50=11.8 p80=16.4 p90=20.7 p95=27.1 p99=41.1 qps=754
2 ------------------------------------------------------------
avg=24.0 p50=16.9 p80=44.4 p90=53.6 p95=58.2 p99=79.3 qps=416
avg=15.0 p50=12.8 p80=17.6 p90=27.2 p95=34.0 p99=44.6 qps=668
```
